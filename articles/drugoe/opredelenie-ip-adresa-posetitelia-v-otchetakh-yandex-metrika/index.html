<!DOCTYPE html>
<html lang="ru"> <head><title>Определение IP адреса посетителя в отчетах Yandex Метрика | Maks live</title><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#00aeff"><meta name="msapplication-navbutton-color" content="#00aeff"><meta name="apple-mobile-web-app-status-bar-style" content="#00aeff"><meta name="author" content="Maks"><meta name="robots" content="index, follow"><meta name="keywords" content="article, ip, javascript, yandex, metrika, watch"><meta name="description" content="Обновленная метрика не отображает информацию об ip адресе посетителей сайта, сделано это с целью обезличивания статистики посещений. Данная новость была официально озвучена в клубе метрики. Обезличивание это здорово, но порой хочется узнать действительно ли в статистике отображаются различные посетители, или же это одно и тот же лицо, которое заходит с разных браузеров или устройств."><meta property="og:title" content="Определение IP адреса посетителя в отчетах Yandex Метрика"><meta property="og:url" content="https://maks.live/articles/drugoe/opredelenie-ip-adresa-posetitelia-v-otchetakh-yandex-metrika/"><meta property="og:site_name" content="Maks live"><meta property="og:type" content="article"><meta property="og:image" content="https://maks.live/media/yametrika-ip/yametrica-watch-you.min.png"><meta property="og:description" content="Обновленная метрика не отображает информацию об ip адресе посетителей сайта, сделано это с целью обезличивания статистики посещений. Данная новость была официально озвучена в клубе метрики. Обезличивание это здорово, но порой хочется узнать действительно ли в статистике отображаются различные посетители, или же это одно и тот же лицо, которое заходит с разных браузеров или устройств."><link rel="canonical" href="https://maks.live/articles/drugoe/opredelenie-ip-adresa-posetitelia-v-otchetakh-yandex-metrika/"><link href="https://maks.live/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Maks live Atom"><link href="https://maks.live/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Maks live RSS"><link rel="stylesheet" type="text/css" href="/theme/css/bootstrap.css"><link rel="stylesheet" type="text/css" href="/theme/css/font-awesome.css"><link rel="stylesheet" type="text/css" href="/theme/css/style.css"><link rel="stylesheet" type="text/css" href="/theme/css/pygment.css"><link rel="stylesheet" type="text/css" href="/theme/css/social-likes_flat.css"><script type="text/javascript" src="/theme/js/jquery.min.js"></script><script type="text/javascript" src="/theme/js/bootstrap.min.js"></script><script type="text/javascript" src="/theme/js/social-likes.min.js"></script><link rel="stylesheet" type="text/css" href="https://maks.live/theme/css/tree.css"><link rel="stylesheet" type="text/css" href="https://maks.live/theme/css/anchorific.css"><script type="text/javascript" src="https://maks.live/theme/js/anchorific.js"></script></head> <body id="index"> <a class="forkmegithub" href="https://github.com/Samael500"> <img style="position: absolute; top: 0; right: 0; border: 0;" src="/theme/images/forkme_right_gray.png" alt="Fork me on GitHub"> </a> <div class="header"> <div class="container"> <div class="logo"> <a href="https://maks.live/"> MAKS LIVE<br><small>samael500 blog</small> </a> </div> <div class="top-menu"> <div class="search"> <script>
  (function() {
    var cx = '006263355362628034990:cuxoisonrno';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script> <form id="searchbox_006263355362628034990:cuxoisonrno" action="https://www.google.com/"> <input value="006263355362628034990:cuxoisonrno" name="cx" type="hidden"> <input value="FORID:11" name="cof" type="hidden"> <input id="q" name="q" type="text" required> <input type="submit" value> </form> </div> <span class="menu"> </span> <ul> <li> <a href="/">HOME</a></li> <li> <a href="/tag/best/">BEST</a></li> <li><a href="https://maks.live/about/">ABOUT</a></li> <div class="clearfix"></div> </ul> <div class="clearfix"></div> <script>
                $("span.menu").click(function(){
                    $(".top-menu ul").slideToggle("slow" , function(){
                    });
                });
            </script> </div> </div> </div> <div class="content"> <div class="container"> <div class="content-grids"> <div class="single-main"> <div class="col-md-9 single-grid"> <header> <h4> <a href="https://maks.live/articles/drugoe/opredelenie-ip-adresa-posetitelia-v-otchetakh-yandex-metrika/" title="Определение IP адреса посетителя в отчетах Yandex Метрика">Определение <span class="caps">IP</span> адреса посетителя в отчетах Yandex&nbsp;Метрика</a> Sep 22, 2015 </h4> <div class="footer art-info"> Author: <a class="url fn" href="https://maks.live/author/maks/">Maks</a> | Category: <a href="https://maks.live/category/drugoe/">Другое</a> | <a href="https://maks.live/articles/drugoe/opredelenie-ip-adresa-posetitelia-v-otchetakh-yandex-metrika/#disqus_thread">Comments</a> <br> Tags: <a href="https://maks.live/tag/ip/">ip</a> <a href="https://maks.live/tag/javascript/">javascript</a> <a href="https://maks.live/tag/yandex/">yandex</a> <a href="https://maks.live/tag/metrika/">metrika</a> <a href="https://maks.live/tag/watch/">watch</a> </div><div class="social-likes"> <div class="vkontakte" title="Поделиться ссылкой во Вконтакте">Вконтакте</div> <div class="twitter" data-via="samael500" title="Поделиться ссылкой в Твиттере">Twitter</div> <div class="facebook" title="Поделиться ссылкой на Фейсбуке">Facebook</div> <div class="plusone" title="Поделиться ссылкой в Google+">Google+</div> </div> </header> <article class="content"> <p>Обновленная метрика не отображает информацию об <code>ip</code> адресе посетителей сайта, сделано это с целью обезличивания статистики посещений. Данная <a href="http://clubs.ya.ru/metrika/replies.xml?item_no=10888">новость</a> была официально озвучена в клубе метрики. Обезличивание это здорово, но порой хочется узнать действительно ли в статистике отображаются различные посетители, или же это одно и тот же лицо, которое заходит с разных браузеров или устройств. А может быть у Вас несколько счетчиков метрики, и Вам интересно какие из посетителей ресурса <em>A</em>, посещают также ресурсы <em>B</em> или <em>C</em>.</p> <p>Также различным рекламщикам, может быть интересна информация об <code>ip</code> адресах, например, с целью вычисления ботов&nbsp;скликеров. </p> <p>К счастью, метрика достаточно гибкая и позволяет устанавливать пользовательские параметры, тем самым создавать специальный персонализированный отчет о действиях пользователей. Благодаря чему, мы можем привязать информацию об <code>ip</code> адресе к конкретному&nbsp;визиту. </p> <h2 id="parametry-vizitov-yandex-metrika"><a class="toclink" href="#parametry-vizitov-yandex-metrika">Параметры визитов&nbsp;yandex.метрика</a></h2> <p>Сервис <a href="https://yandex.ru/support/metrika/reports/visit-params.xml">параметры визитов</a> позволяет прикрепить к информации о посещении <code>json</code> словарь с дополнительными параметрами. Для этого необходимо в конструктор счетчика добавить аргумент <code>params</code> с необходимыми&nbsp;значениями.</p> <p>Например, если информация об <code>ip</code> адресе будет содержаться в переменой <code>userip</code>, то словарь параметры может выглядеть следующим&nbsp;образом:</p> <div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">&#39;ip&#39;</span><span class="o">:</span> <span class="nx">userip</span>
<span class="p">}</span>
</pre></div> <p>Конструктор счетчика, в таком случае, будет выглядеть&nbsp;так:</p> <div class="highlight"><pre><span></span>    <span class="nx">w</span><span class="p">.</span><span class="nx">yaCounterXXXXXX</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Ya</span><span class="p">.</span><span class="nx">Metrika</span><span class="p">({</span>
        <span class="nx">id</span><span class="o">:</span><span class="nx">XXXXXX</span><span class="p">,</span>
        <span class="nx">clickmap</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
        <span class="nx">trackLinks</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
        <span class="nx">accurateTrackBounce</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
        <span class="nx">webvisor</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
        <span class="nx">params</span><span class="o">:</span><span class="p">{</span><span class="s1">&#39;ip&#39;</span><span class="o">:</span> <span class="nx">userip</span><span class="p">}</span>
    <span class="p">});</span>
</pre></div> <p>Где <code>XXXXXX</code> идентификатор&nbsp;счетчика.</p> <p>Чтобы просмотреть полученные результаты необходимо перейти: <code>метрика</code> &rarr; <code>отчеты</code> &rarr; <code>стандартные отчеты</code> &rarr; <code>содержание</code> &rarr; <code>параметры визитов</code></p> <p><img alt="visit params path" class="center shadow" src="/media/yametrika-ip/visit_params_path.png" title="Путь к отчету по параметрам визитов."></p> <p><img alt="visit params detail" class="center shadow" src="/media/yametrika-ip/visit_params_detail.png" title="Отчет по параметрам визитов."></p> <p>Но, сами по себе <code>ip</code> адреса не столь информативны, интерестнее просмотреть связь посещения и <code>ip</code> адреса в вебвизоре. Для этого в вебвизор нужно добавить столбец&nbsp;&#8220;Параметры&#8221;.</p> <p><img alt="webvisor col params" class="center shadow" src="/media/yametrika-ip/webvisor_col_params.png" title="Добавление столбца параметры в вебвизоре."></p> <p><img alt="webvisor ip detail" class="center shadow" src="/media/yametrika-ip/webvisor_ip_detail.png" title="Параметры визитов в вебвизоре."></p> <h2 id="opredelenie-ip-adresa"><a class="toclink" href="#opredelenie-ip-adresa">Определение <span class="caps">IP</span>&nbsp;адреса</a></h2> <p>Выше я упоминал о переменной в которой содержится <code>ip</code> адрес посетителя. Задать эту переменную легко если Вы имеете доступ к&nbsp;бэкэнду.</p> <p>Например в <code>django</code>, предварительно подключив <code>django.core.context_processors.request</code>:</p> <div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span><span class="p">&gt;</span>
    <span class="kd">var</span> <span class="nx">userip</span> <span class="o">=</span> <span class="s2">&quot;{{ request.META.REMOTE_ADDR }}&quot;</span><span class="p">;</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div> <p>Или, если Вы используете&nbsp;проксирование:</p> <div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span><span class="p">&gt;</span>
    <span class="kd">var</span> <span class="nx">userip</span> <span class="o">=</span> <span class="s2">&quot;{{ request.META.HTTP_X_REAL_IP }}&quot;</span><span class="p">;</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div> <p>Или, например, в <code>php</code>:</p> <div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span><span class="p">&gt;</span>
    <span class="kd">var</span> <span class="nx">userip</span> <span class="o">=</span> <span class="s2">&quot;&lt;? echo $_SERVER[&#39;REMOTE_ADDR&#39;];?&gt;&quot;</span><span class="p">;</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div> <p>Но что если сайт статический и какой либо бэкэнд отсутствует? В таком случае можно воспользоваться сервисом <a href="https://l2.io">l2.io</a>, который позволяет получить <code>ip</code> на клиенте. К примеру Ваш <code>ip</code> адрес: <strong><script type="text/javascript" src="https://www.l2.io/ip.js"></script></strong></p> <p>Чтобы задать <code>ip</code> адрес в переменную, нужно вставить такой&nbsp;скрипт:</p> <div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://www.l2.io/ip.js?var=userip&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div> <p>Полный фрагмент скрипта яндекс метрики будет выглядеть&nbsp;так:</p> <div class="highlight"><pre><span></span><span class="c">&lt;!-- получаем ip адрес одним из указанных вариантов --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://www.l2.io/ip.js?var=userip&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="c">&lt;!-- Yandex.Metrika counter --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span><span class="p">&gt;</span>
    <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">(</span><span class="nx">w</span><span class="p">[</span><span class="nx">c</span><span class="p">]</span> <span class="o">=</span> <span class="nx">w</span><span class="p">[</span><span class="nx">c</span><span class="p">]</span> <span class="o">||</span> <span class="p">[]).</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="nx">w</span><span class="p">.</span><span class="nx">yaCounterXXXXXX</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Ya</span><span class="p">.</span><span class="nx">Metrika</span><span class="p">({</span>
                    <span class="nx">id</span><span class="o">:</span><span class="nx">XXXXXX</span><span class="p">,</span>
                    <span class="nx">clickmap</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
                    <span class="nx">trackLinks</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
                    <span class="nx">accurateTrackBounce</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
                    <span class="nx">webvisor</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
                    <span class="nx">params</span><span class="o">:</span><span class="p">{</span><span class="s1">&#39;ip&#39;</span><span class="o">:</span> <span class="nx">userip</span><span class="p">}</span>
                <span class="p">});</span>
            <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
        <span class="p">});</span>
    <span class="c1">// продолжение счетчика</span>
    <span class="c1">// ...</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="c">&lt;!-- /Yandex.Metrika counter --&gt;</span>
</pre></div> </article> <div class="comments"> <div id="disqus_thread"></div> <script type="text/javascript">
                    var disqus_identifier = "articles/drugoe/opredelenie-ip-adresa-posetitelia-v-otchetakh-yandex-metrika/";
                    (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//samael500.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                </script> </div> </div> <div class="col-md-3 content-right"> <div class="anchorific"></div> </div> </div> </div> </div> </div> <div class="footer"> <div class="container"> <p>This blog is proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.</p> <p><a href="http://github.com/samael500/w3-personal-blog/">W3 Personal Blog</a> is a flat <a href="http://getbootstrap.com/">bootstrap</a> responsive theme designed by <a href="https://w3layouts.com/personal-blog-a-blogging-category-flat-bootstrap-responsive-web-template/">W3layouts</a> ported to a pelican by <a href="http://samael500.github.io/">Samael500</a>.<p> <p>Copyrights &copy; 2015&mdash;2017 Maks live All rights reserved.</p> <p><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"> <img alt="Creative Commons License" style="border-width:0" src="/media/by-nc-sa.svg"></a> This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"> Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</p> </div> </div> <script type="text/javascript" src="https://www.l2.io/ip.js?var=userip"></script> <script type="text/javascript">
    (function (d, w, c) {
        (w[c] = w[c] || []).push(function() {
            try {
                w.yaCounter32194009 = new Ya.Metrika({
                    id:32194009,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true,
                    webvisor:true,
                    params:{'ip': userip}
                });
            } catch(e) { }
        });

        var n = d.getElementsByTagName("script")[0],
            s = d.createElement("script"),
            f = function () { n.parentNode.insertBefore(s, n); };
        s.type = "text/javascript";
        s.async = true;
        s.src = "https://mc.yandex.ru/metrika/watch.js";

        if (w.opera == "[object Opera]") {
            d.addEventListener("DOMContentLoaded", f, false);
        } else { f(); }
    })(document, window, "yandex_metrika_callbacks");
</script> <noscript><div><img src="https://mc.yandex.ru/watch/32194009" style="position:absolute; left:-9999px;" alt></div></noscript> <script>
        (function(w, d, c) {
            (w[c] = w[c] || []).push(function() {
                try {
                    var options = {
                        project: '987654231',
                        attributes_dataset: [
                            'cerber-event',
                            'cerber-head',
                            'second-cerber-event',
                            'cerber-topline'
                        ],
                        custom_vars: {
                            'test_key1': 'test_val1',
                            'test_key2': 'test_val2'
                        },
                        trackLinks: true,
                        splits: ['some_split']
                    };
                    w.top100Counter = new top100(
                        options
                    );

                    w.top100Counter.sendCustomVars({'test=test.,!@#$%^&*()_test': 'test=test.,!@#$%^&*()_test'});
                } catch (e) {
                    console.log(e);
                }
            });

            var n = d.getElementsByTagName("script")[0],
                s = d.createElement("script"),
                f = function() {
                    n.parentNode.insertBefore(s, n);
                };
            s.type = "text/javascript";
            s.async = true;
            s.src =
                (d.location.protocol == "https:" ? "http:" : "http:") +
                "//stand07.cerber.rambler.ru/counters/top100.js"
                //"//st.top100.ru/top100/top100.js";

            if (w.opera == "[object Opera]") {
                d.addEventListener("DOMContentLoaded", f, false);
            } else {
                f();
            }
        })(window, document, "_top100q");
</script> <script type="text/javascript">
    var disqus_shortname = 'samael500';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script> </body> </html>