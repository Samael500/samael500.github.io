/*! Social Likes v3.0.14 by Artem Sapegin - http://sapegin.github.com/social-likes - Licensed MIT */
;!function(b){"function"==typeof define&&define.amd?define(["jquery"],b):b(jQuery)}(function(H,G){function F(d,c){this.container=d,this.options=c,this.init()}function E(a,d){this.widget=a,this.options=H.extend({},d),this.detectService(),this.service&&this.init()}function D(h){function g(d,c){return c.toUpper()}var l={},k=h.data();for(var j in k){var i=k[j];"yes"===i?i=!0:"no"===i&&(i=!1),l[j.replace(/-(\w)/g,g)]=i}return l}function C(d,c){return B(d,c,encodeURIComponent)}function B(e,d,f){return e.replace(/\{([^\}]+)\}/g,function(b,c){return c in d?f?f(d[c]):d[c]:b})}function A(e,d){var f=w+e;return f+" "+f+"_"+d}function z(a,j){function i(b){"keydown"===b.type&&27!==b.which||H(b.target).closest(a).length||(a.removeClass(v),h.off(g,i),H.isFunction(j)&&j())}var h=H(document),g="click touchstart keydown";h.on(g,i)}function y(g){var f=10;if(document.documentElement.getBoundingClientRect){var j=parseInt(g.css("left"),10),i=parseInt(g.css("top"),10),h=g[0].getBoundingClientRect();h.left<f?g.css("left",f-h.left+j):h.right>window.innerWidth-f&&g.css("left",window.innerWidth-h.right-f+j),h.top<f?g.css("top",f-h.top+i):h.bottom>window.innerHeight-f&&g.css("top",window.innerHeight-h.bottom-f+i)}g.addClass(v)}var x="social-likes",w=x+"__",v=x+"_opened",u="https:"===location.protocol?"https:":"http:",t="https:"===u,s={facebook:{counterUrl:"https://graph.facebook.com/fql?q=SELECT+total_count+FROM+link_stat+WHERE+url%3D%22{url}%22&callback=?",convertNumber:function(b){return b.data[0].total_count},popupUrl:"https://www.facebook.com/sharer/sharer.php?u={url}",popupWidth:600,popupHeight:500},twitter:{counterUrl:"https://cdn.api.twitter.com/1/urls/count.json?url={url}&callback=?",convertNumber:function(b){return b.count},popupUrl:"https://twitter.com/intent/tweet?url={url}&text={title}",popupWidth:600,popupHeight:450,click:function(){return/[\.\?:\-–—]\s*$/.test(this.options.title)||(this.options.title+=":"),!0}},mailru:{counterUrl:u+"//connect.mail.ru/share_count?url_list={url}&callback=1&func=?",convertNumber:function(d){for(var c in d){if(d.hasOwnProperty(c)){return d[c].shares}}},popupUrl:u+"//connect.mail.ru/share?share_url={url}&title={title}",popupWidth:550,popupHeight:360},vkontakte:{counterUrl:"https://vk.com/share.php?act=count&url={url}&index={index}",counter:function(a,h){var g=s.vkontakte;g._||(g._=[],window.VK||(window.VK={}),window.VK.Share={count:function(d,c){g._[d].resolve(c)}});var f=g._.length;g._.push(h),H.getScript(C(a,{index:f})).fail(h.reject)},popupUrl:u+"//vk.com/share.php?url={url}&title={title}",popupWidth:550,popupHeight:330},odnoklassniki:{counterUrl:t?G:"http://connect.ok.ru/dk?st.cmd=extLike&ref={url}&uid={index}",counter:function(a,h){var g=s.odnoklassniki;g._||(g._=[],window.ODKL||(window.ODKL={}),window.ODKL.updateCount=function(d,c){g._[d].resolve(c)});var f=g._.length;g._.push(h),H.getScript(C(a,{index:f})).fail(h.reject)},popupUrl:"http://connect.ok.ru/dk?st.cmd=WidgetSharePreview&service=odnoklassniki&st.shareUrl={url}",popupWidth:550,popupHeight:360},plusone:{counterUrl:t?G:"http://share.yandex.ru/gpp.xml?url={url}",counter:function(a,f){var e=s.plusone;return e._?void f.reject():(window.services||(window.services={}),window.services.gplus={cb:function(b){"string"==typeof b&&(b=b.replace(/\D/g,"")),e._.resolve(parseInt(b,10))}},e._=f,void H.getScript(C(a)).fail(f.reject))},popupUrl:"https://plus.google.com/share?url={url}",popupWidth:700,popupHeight:500},pinterest:{counterUrl:u+"//api.pinterest.com/v1/urls/count.json?url={url}&callback=?",convertNumber:function(b){return b.count},popupUrl:u+"//pinterest.com/pin/create/button/?url={url}&description={title}",popupWidth:630,popupHeight:270}},r={promises:{},fetch:function(a,n,m){r.promises[a]||(r.promises[a]={});var l=r.promises[a];if(!m.forceUpdate&&l[n]){return l[n]}var k=H.extend({},s[a],m),j=H.Deferred(),f=k.counterUrl&&C(k.counterUrl,{url:n});return f&&H.isFunction(k.counter)?k.counter(f,j):k.counterUrl?H.getJSON(f).done(function(e){try{var h=e;H.isFunction(k.convertNumber)&&(h=k.convertNumber(e)),j.resolve(h)}catch(g){j.reject()}}).fail(j.reject):j.reject(),l[n]=j.promise(),l[n]}};H.fn.socialLikes=function(a){return this.each(function(){var c=H(this),b=c.data(x);b?H.isPlainObject(a)&&b.update(a):(b=new F(c,H.extend({},H.fn.socialLikes.defaults,a,D(c))),c.data(x,b))})},H.fn.socialLikes.defaults={url:window.location.href.replace(window.location.hash,""),title:document.title,counters:!0,zeroes:!1,wait:500,timeout:10000,popupCheckInterval:500,singleTitle:"Share"},F.prototype={init:function(){this.container.addClass(x),this.single=this.container.hasClass(x+"_single"),this.initUserButtons(),this.countersLeft=0,this.number=0,this.container.on("counter."+x,H.proxy(this.updateCounter,this));var a=this.container.children();this.makeSingleButton(),this.buttons=[],a.each(H.proxy(function(d,g){var f=new E(H(g),this.options);this.buttons.push(f),f.options.counterUrl&&this.countersLeft++},this)),this.options.counters?(this.timer=setTimeout(H.proxy(this.appear,this),this.options.wait),this.timeout=setTimeout(H.proxy(this.ready,this,!0),this.options.timeout)):this.appear()},initUserButtons:function(){!this.userButtonInited&&window.socialLikesButtons&&H.extend(!0,s,socialLikesButtons),this.userButtonInited=!0},makeSingleButton:function(){if(this.single){var a=this.container;a.addClass(x+"_vertical"),a.wrap(H("<div>",{"class":x+"_single-w"})),a.wrapInner(H("<div>",{"class":x+"__single-container"}));var h=a.parent(),g=H("<div>",{"class":A("widget","single")}),f=H(B('<div class="{buttonCls}"><span class="{iconCls}"></span>{title}</div>',{buttonCls:A("button","single"),iconCls:A("icon","single"),title:this.options.singleTitle}));g.append(f),h.append(g),g.on("click",function(){var b=x+"__widget_active";return g.toggleClass(b),g.hasClass(b)?(a.css({left:-(a.width()-g.width())/2,top:-a.height()}),y(a),z(a,function(){g.removeClass(b)})):a.removeClass(v),!1}),this.widget=g}},update:function(a){if(a.forceUpdate||a.url!==this.options.url){this.number=0,this.countersLeft=this.buttons.length,this.widget&&this.widget.find("."+x+"__counter").remove(),H.extend(this.options,a);for(var d=0;d<this.buttons.length;d++){this.buttons[d].update(a)}}},updateCounter:function(e,d,f){f&&(this.number+=f,this.single&&this.getCounterElem().text(this.number)),this.countersLeft--,0===this.countersLeft&&(this.appear(),this.ready())},appear:function(){this.container.addClass(x+"_visible")},ready:function(b){this.timeout&&clearTimeout(this.timeout),this.container.addClass(x+"_ready"),b||this.container.trigger("ready."+x,this.number)},getCounterElem:function(){var a=this.widget.find("."+w+"counter_single");return a.length||(a=H("<span>",{"class":A("counter","single")}),this.widget.append(a)),a}},E.prototype={init:function(){this.detectParams(),this.initHtml(),setTimeout(H.proxy(this.initCounter,this),0)},update:function(a){H.extend(this.options,{forceUpdate:!1},a),this.widget.find("."+x+"__counter").remove(),this.initCounter()},detectService:function(){var a=this.widget.data("service");if(!a){for(var j=this.widget[0],i=j.classList||j.className.split(" "),h=0;h<i.length;h++){var g=i[h];if(s[g]){a=g;break}}if(!a){return}}this.service=a,H.extend(this.options,s[a])},detectParams:function(){var d=this.widget.data();if(d.counter){var c=parseInt(d.counter,10);isNaN(c)?this.options.counterUrl=d.counter:this.options.counterNumber=c}d.title&&(this.options.title=d.title),d.url&&(this.options.url=d.url)},initHtml:function(){var a=this.options,l=this.widget,k=l.find("a");k.length&&this.cloneDataAttrs(k,l);var j=H("<span>",{"class":this.getElementClassNames("button"),text:l.text()});if(a.clickUrl){var i=C(a.clickUrl,{url:a.url,title:a.title}),f=H("<a>",{href:i});this.cloneDataAttrs(l,f),l.replaceWith(f),this.widget=l=f}else{l.on("click",H.proxy(this.click,this))}l.removeClass(this.service),l.addClass(this.getElementClassNames("widget")),j.prepend(H("<span>",{"class":this.getElementClassNames("icon")})),l.empty().append(j),this.button=j},initCounter:function(){if(this.options.counters){if(this.options.counterNumber){this.updateCounter(this.options.counterNumber)}else{var a={counterUrl:this.options.counterUrl,forceUpdate:this.options.forceUpdate};r.fetch(this.service,this.options.url,a).always(H.proxy(this.updateCounter,this))}}},cloneDataAttrs:function(f,e){var h=f.data();for(var g in h){h.hasOwnProperty(g)&&e.data(g,h[g])}},getElementClassNames:function(b){return A(b,this.service)},updateCounter:function(a){a=parseInt(a,10)||0;var f={"class":this.getElementClassNames("counter"),text:a};a||this.options.zeroes||(f["class"]+=" "+x+"__counter_empty",f.text="");var e=H("<span>",f);this.widget.append(e),this.widget.trigger("counter."+x,[this.service,a])},click:function(a){var h=this.options,g=!0;if(H.isFunction(h.click)&&(g=h.click.call(this,a)),g){var f=C(h.popupUrl,{url:h.url,title:h.title});f=this.addAdditionalParamsToUrl(f),this.openPopup(f,{width:h.popupWidth,height:h.popupHeight})}return !1},addAdditionalParamsToUrl:function(a){var f=H.param(H.extend(this.widget.data(),this.options.data));if(H.isEmptyObject(f)){return a}var e=-1===a.indexOf("?")?"?":"&";return a+e+f},openPopup:function(a,l){var k=Math.round(screen.width/2-l.width/2),j=0;screen.height>l.height&&(j=Math.round(screen.height/3-l.height/2));var i=window.open(a,"sl_"+this.service,"left="+k+",top="+j+",width="+l.width+",height="+l.height+",personalbar=0,toolbar=0,scrollbars=1,resizable=1");if(i){i.focus(),this.widget.trigger("popup_opened."+x,[this.service,i]);var h=setInterval(H.proxy(function(){i.closed&&(clearInterval(h),this.widget.trigger("popup_closed."+x,this.service))},this),this.options.popupCheckInterval)}else{location.href=a}}},H(function(){H("."+x).socialLikes()})});